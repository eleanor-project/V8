# ELEANOR V8 — Production Environment Configuration
# ==================================================
# This template provides production-ready defaults with security best practices
#
# SETUP INSTRUCTIONS:
# 1. Copy this file: cp .env.production.template .env
# 2. Run: ./scripts/generate_secrets.sh (to generate secure secrets)
# 3. Add your LLM API keys below
# 4. Run: ./scripts/validate_env.sh (to verify configuration)
# 5. Never commit .env to version control

# ==================================================
# CRITICAL SECURITY SETTINGS
# ==================================================

# Environment mode - MUST be 'production' for production deployments
ELEANOR_ENV=production

# JWT Secret - Generate with: openssl rand -base64 32
# ⚠️  CRITICAL: Must be 32+ characters, cryptographically random
JWT_SECRET=

# Grafana Admin Credentials
# Generate password with: openssl rand -base64 20
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=

# PostgreSQL Password (used in docker-compose)
# Generate with: openssl rand -base64 20
POSTGRES_PASSWORD=

# ==================================================
# LLM PROVIDER API KEYS
# ==================================================
# Configure at least ONE provider for ELEANOR to function
# Get keys from: https://platform.openai.com, https://console.anthropic.com, etc.

# OpenAI (GPT models)
OPENAI_KEY=

# Anthropic (Claude models)
ANTHROPIC_KEY=

# xAI (Grok models)
XAI_KEY=

# Google (Gemini models)
GEMINI_KEY=

# ==================================================
# ROUTING POLICY (OPTIONAL)
# ==================================================
# Cost-based routing: Prevent expensive model calls

# Adapter costs in USD per 1K tokens (example values)
ROUTER_ADAPTER_COSTS={"gpt-4":0.06,"gpt-3.5-turbo":0.002,"claude-3-opus":0.015}

# Maximum cost per request (USD) - empty means no limit
ROUTER_MAX_COST=

# Latency-based routing: Ensure response time SLAs
# Adapter latencies in milliseconds (example values)
ROUTER_ADAPTER_LATENCIES={"gpt-4":1200,"gpt-3.5-turbo":600}

# Maximum latency budget in milliseconds - empty means no limit
ROUTER_LATENCY_BUDGET_MS=

# ==================================================
# LOCAL MODELS (OLLAMA) - OPTIONAL
# ==================================================
# For cost-effective local model deployment

# Default Ollama model (can be: llama3, phi3, mistral, etc.)
OLLAMA_MODEL=llama3

# Optional: Comma-separated list to register multiple Ollama models
OLLAMA_MODELS=llama3,phi3

# Hugging Face models (if using local HF models)
HF_MODELS=meta-llama/Llama-3-8b,microsoft/Phi-3-mini-4k-instruct
HF_DEVICE=cpu

# ==================================================
# PRECEDENT STORAGE & EMBEDDINGS
# ==================================================

# Precedent backend: weaviate | pgvector | memory
# ⚠️  PRODUCTION: Use 'weaviate' or 'pgvector' (NOT 'memory')
PRECEDENT_BACKEND=weaviate

# Embedding backend for vector search
EMBEDDING_BACKEND=gpt

# Weaviate configuration (if PRECEDENT_BACKEND=weaviate)
WEAVIATE_URL=http://weaviate:8080

# PostgreSQL + pgvector configuration (if PRECEDENT_BACKEND=pgvector)
# ⚠️  Update with POSTGRES_PASSWORD from above
PG_CONN_STRING=postgresql://postgres:REPLACE_WITH_POSTGRES_PASSWORD@pgvector:5432/eleanor
PG_TABLE=precedent

# ==================================================
# GOVERNANCE (OPA - Open Policy Agent)
# ==================================================

# OPA service URL (Docker internal network)
OPA_URL=http://opa:8181

# OPA policy decision path
OPA_POLICY_PATH=v1/data/eleanor/decision

# OPA failure strategy: allow | deny | escalate
# ⚠️  PRODUCTION: Use 'escalate' or 'deny' (NEVER 'allow')
OPA_FAIL_STRATEGY=escalate

# Disable OPA completely (for testing only)
# ⚠️  PRODUCTION: MUST be 0 or false
ELEANOR_DISABLE_OPA=0

# ==================================================
# CRITIC MODEL BINDINGS (OPTIONAL)
# ==================================================
# Configure which models to use for different critics

# Use Ollama model for critics (auto-creates adapter name)
# OLLAMA_CRITIC_MODEL=phi3

# Force all critics to a specific adapter
# CRITIC_DEFAULT_ADAPTER=ollama-phi3

# Explicit per-critic mapping (JSON format)
# CRITIC_MODEL_BINDINGS={"rights":"ollama-phi3","autonomy":"ollama-phi3"}

# ==================================================
# EVIDENCE & AUDIT LOGGING
# ==================================================

# Evidence trail storage path (Docker volume mount)
EVIDENCE_PATH=/app/audit/evidence.jsonl

# Replay log storage path (Docker volume mount)
REPLAY_LOG_PATH=/app/audit/replay_log.jsonl

# ==================================================
# MONITORING & OBSERVABILITY
# ==================================================

# Prometheus metrics middleware
ENABLE_PROMETHEUS_MIDDLEWARE=1

# OpenTelemetry distributed tracing (optional)
ENABLE_OTEL=0

# OTEL configuration (if ENABLE_OTEL=1)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://otel-collector:4318/v1/traces
# OTEL_SERVICE_NAME=eleanor-v8-api

# ==================================================
# SECURITY CONTROLS
# ==================================================

# Maximum request body size (bytes) - 1MB default
MAX_REQUEST_BYTES=1048576

# CORS allowed origins
# ⚠️  PRODUCTION: Use specific domains (NO wildcards or localhost)
# Example: CORS_ORIGINS=https://app.yourdomain.com,https://admin.yourdomain.com
CORS_ORIGINS=

# ==================================================
# RATE LIMITING
# ==================================================

# Rate limiting: requests per window
RATE_LIMIT_REQUESTS_PER_WINDOW=30

# Rate limiting: window size in seconds
RATE_LIMIT_WINDOW_SECONDS=60

# ==================================================
# PRODUCTION NOTES
# ==================================================
#
# BEFORE DEPLOYMENT:
# 1. ✅ All CRITICAL SECURITY SETTINGS are configured
# 2. ✅ At least one LLM API key is set
# 3. ✅ PRECEDENT_BACKEND is NOT 'memory'
# 4. ✅ OPA_FAIL_STRATEGY is NOT 'allow'
# 5. ✅ CORS_ORIGINS uses production domains only
# 6. ✅ Run ./scripts/validate_env.sh to verify
#
# SECRETS MANAGEMENT:
# - Store in AWS Secrets Manager, HashiCorp Vault, or similar
# - Rotate JWT_SECRET and passwords every 90 days
# - Use different secrets for dev/staging/prod
# - Monitor API key usage and quotas
#
# COMPLIANCE:
# - EVIDENCE_PATH and REPLAY_LOG_PATH enable audit trails
# - Configure log rotation to prevent unbounded growth
# - Backup audit logs to secure off-site storage
# - Retain audit logs per regulatory requirements
